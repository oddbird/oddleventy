name: Push commits to shadow repo

on: push

jobs:
  push:
    runs-on: ubuntu-latest
    env:
      API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
    steps:
      - uses: actions/checkout@v3
      - name: Set env vars
        run: echo "BRANCH_NAME=${GITHUB_REF##*/}" >> $GITHUB_ENV
      - uses: actions/setup-node@v3
        with:
          node-version-file: .nvmrc
          cache: yarn
      - run: yarn install
      - run: yarn build
      - name: Push to shadow branch
        uses: cpina/github-action-push-to-another-repository@74596b72fae72d9b7b79e1b2992863c0f595c801
        with:
          source-directory: _site
          destination-github-username: ${{ secrets.SHADOW_OWNER }}
          destination-repository-name: ${{ secrets.SHADOW_REPO }}
          user-email: ${{ secrets.SHADOW_AUTHOR }}
          target-branch: ${{ env.BRANCH_NAME }}
