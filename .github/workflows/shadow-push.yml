name: Push commits to shadow repo

on: push

jobs:
  push:
    runs-on: ubuntu-latest
    env:
      API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
    steps:
      - uses: actions/checkout@v2
      - name: Set env vars
        run: |
          echo "BRANCH_NAME=${GITHUB_REF##*/}" >> $GITHUB_ENV
          echo NODE_VERSION=`cat .nvmrc` >> $GITHUB_ENV
      - uses: actions/setup-node@v2
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'yarn'
      - run: yarn install
      - run: yarn build
      - name: Push to shadow branch
        uses: cpina/github-action-push-to-another-repository@74596b72fae72d9b7b79e1b2992863c0f595c801
        with:
          source-directory: _site
          destination-github-username: ${{ secrets.SHADOW_OWNER }}
          destination-repository-name: ${{ secrets.SHADOW_REPO }}
          user-email: ${{ secrets.SHADOW_AUTHOR }}
          target-branch: ${{ env.BRANCH_NAME }}
