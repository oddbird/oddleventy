{% import 'post.macros.njk' as post %}
{% import 'oss.macros.njk' as oss %}
{% import 'events.macros.njk' as confs %}

{%- set is_post = tags and ('_post' in tags) -%}

{% if index %}
  <section data-list="tag" data-typeset>
    {% set list = collections[index] %}
    {{ post.by_year(
      list | removePage(page.url) if list else none,
      collections
    ) }}
  </section>
{% elif bird and (bird != 'oddbird') %}
  {% set this_page = collections.all | getCollectionItem(page) %}
  {% set bird_pages = collections.all | byBird(bird) %}
  <section data-list="bird" data-typeset>
    {{ confs.list(
      title='Upcoming Events',
      events=bird_pages | concat([this_page]) | getEvents,
      all=false
    ) }}
    {{ oss.list(
      collections.oss | byBird(bird),
      collections
    ) }}
    {{ post.by_year(
      collections._post | byBird(bird),
      collections
    ) }}
  </section>
{% elif events %}
  <section data-list="events" data-typeset>
    {{ confs.list(
      'Events',
      collections.all | getCollectionItem(page) | pageEvents
    ) }}

    {% if is_post %}
      <section data-list="tag" data-typeset>
      {{ post.recent_posts(collections['Talk'], collections, banner_title="Talks", page_url=page_url)}}
    </section>
    {% endif %}
  </section>
{% elif is_post %}
  {% if 'Article' in tags %}
    <section data-list="tag" data-typeset>
    {{ post.recent_posts(collections['Article'], collections, banner_title="Articles", page_url=page_url)}}
    </section>
  {% elif 'Podcast' in tags %}
    <section data-list="tag" data-typeset>
      {{ post.recent_posts(collections['Podcast'], collections, banner_title="Podcasts", page_url=page_url)}}
    </section>
  {% endif %}

{% endif %}
